The subdirectories `clients` and `lib` contain the yast-libvirt-import source code files that would have to be added to the yast-installation package if we upstreamed it, i.e. the "new code".

But we also need to patch existing files of the yast-installation package so that that new code gets called at all:

- `/control.xml`: this is the [product control file](https://github.com/yast/yast-installation/blob/master/doc/control-file.md) that configures the installation workflow and can be found on every installation medium. It may remind of an Autoyast control file, especially since it can also be used to configure things such as the installation language, but it's more intended to customize an installation than to automate it. Product control files also define proposal screens which call out to proposal modules. This is the place where we call the `LibvirtImportProposalClient`.
- `lib/installation/clients/inst_pre_install.rb`: this is where Yast examines hard disks for existing Linux installations and tries to save data from it (existing users, SSH keys and configuration). Behind the existing call to `read_ssh_info` we hook a call to a `read_libvirt_info` function which in turn calls our `LibvirtImporter`'s `scan_device` function.
- `lib/installation/clients/copy_files_finish.rb`: this is where Yast copies files into the installed system. Behind the existing call to `copy_ssh_files` we hook a call to a `copy_libvirt_files` function which in turn calls our `LibvirtImporter`'s `write_cfgfiles` function.

In theory we would also patch `clients/inst_autosetup.rb`: in an automated installation the first dialogs in the installation get replaced by `InstAutosetupClient` which uses the choices made in the Autoyast control file. To fully support Autoyast, we would need to implement our own module here as well. Currently we don't have one, meaning that if you perform an automatic installation *without* confirmation, <tt>libvirt_import</tt> will always import *all* configuration files it finds.

The way the new code and the patching get into the installation system is a Driver Update Disk (DUD) package (see the [Update-Media-HOWTO](https://ftp.suse.com/pub/people/hvogel/Update-Media-HOWTO/). Driver Update Disk (DUD) packages may contain a script `update.pre` which gets executed before Yast is started . In our case this script is the glue that patches Yast files in the installation system - in a truly ugly but working way, using a wild orgy of shell scripting and `sed` regular expressions. Because we're using an installation system loaded from the network that can change over time, we can't simply overwrite these files. And I can't use patches because `patch` is not available in the installation system. On the positive side, the regexps used are probably more likely to apply cleanly in the future than a patch.

Patching existing files is also a bit complicated since they're on read-only storage when using a network install system. We work around this by placing the patched files in the y2update/ subdirectory where they will be picked up by Yast.
